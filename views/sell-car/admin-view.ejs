<%# Admin view for managing sell car requests %>
<h1>Sell Car Requests - Admin View</h1>

<%- messages() %> <%# Display any flash messages %>

<% if (requests && requests.length > 0) { %>
    <table class="admin-table">
        <thead>
        <tr>
            <th>Date</th>
            <th>Customer</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Vehicle</th>
            <th>Year</th>
            <th>Miles</th>
            <th>Asking Price</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
            <%# Loop through each sell car request and display its details %>
        <% requests.forEach(request => { %>
            <tr>
            <td><%= new Date(request.request_date).toLocaleDateString() %></td>
            <td><%= request.account_firstname %> <%= request.account_lastname %></td>
            <td><%= request.account_email %></td>
            <td><%= request.contact_phone %></td>
            <td><%= request.car_make %> <%= request.car_model %></td>
            <td><%= request.car_year %></td>
            <td><%= Number(request.car_miles).toLocaleString() %></td>
            <td>$<%= Number(request.asking_price).toLocaleString('en-US', {minimumFractionDigits: 2}) %></td>
            <td><%= request.status %></td>
            <td>
                <%# Form to update the status of the request %>
                <form action="/sell-car/admin/update-status" method="post" style="display: inline;">
                <input type="hidden" name="request_id" value="<%= request.request_id %>">
                <select name="status" onchange="this.form.submit()">
                    <option value="pending" <%= request.status === 'pending' ? 'selected' : '' %>>Pending</option>
                    <option value="contacted" <%= request.status === 'contacted' ? 'selected' : '' %>>Contacted</option>
                    <option value="completed" <%= request.status === 'completed' ? 'selected' : '' %>>Completed</option>
                    <option value="declined" <%= request.status === 'declined' ? 'selected' : '' %>>Declined</option>
                </select>
                </form>
                
                <form action="/sell-car/admin/delete" method="post" style="display: inline;">
                <input type="hidden" name="request_id" value="<%= request.request_id %>">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this request?')">Delete</button>
                </form>
            </td>
            </tr>
            <tr>
            <td colspan="10" style="padding-left: 20px;">
                <%# Display additional details about the request %>
                <strong>Description:</strong> <%= request.car_description %><br>
                <strong>Color:</strong> <%= request.car_color %> | 
                <strong>Classification:</strong> <%= request.classification_name %>
            </td>
            </tr>
        <% }) %>
        </tbody>
    </table>
    <% } else { %>
    <p>No sell car requests at this time.</p> <%# Display a message if there are no requests %>
<% } %>
